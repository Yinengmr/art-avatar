"use strict";var t=require("fs"),e=require("https"),a=require("path"),i=require("child_process"),o=require("http");function p(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=p(t),r=p(e),l=p(a),s=p(i),c=p(o);let m=n.default,x={},d=process.env.WEBOX_CONF_FILE;d&&m.existsSync(d)&&(x=require(d));var f=Object.assign({WEBOX_MODE:process.env.NODE_ENV||"development",WEBOX_HOST:"127.0.0.1",WEBOX_PORT:80,WEBOX_ROOT:"webroot",WEBOX_INDEX:["index.html","index.htm"],WEBOX_ERROR:{200:"%s",400:"Bad Request: %s",403:"Forbidden : %s",404:"NO Found: %s",500:"Internal Server Error: %s",503:"Service Unavilable: %s"},WEBOX_CHECK_API:"https://api.vmlu.com/webox/?platform=node"},x);let g=f;function u(t,e){let a=e||new Date,i={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in i)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?i[e]:("00"+i[e]).substr((""+i[e]).length)));return t}void 0===console.light&&(console.light=Function);var v={logger:function(t,...e){if("development"!==g.WEBOX_MODE&&t>0)return;let a="["+u("yyyy-MM-dd hh:mm:ss")+"]";console.log(a,"Webox -",...e)},parseJSON:function(t){if("string"==typeof t)try{return JSON.parse(t)}catch(t){}},dateFormat:u,httpMessage:function(t,e,a,i){a=a||200,i=i||"text/plain","object"==typeof e&&(e=JSON.stringify(e),i="application/json"),"text/plain"==i&&g.WEBOX_ERROR[a]&&(e=g.WEBOX_ERROR[a].replace("%s",e)),t.writeHead(a,{"Content-Length":e.length,"Content-Type":i}),t.write(e),t.end()}};let{logger:O}=v;process.title="Webox - HTTP Server",process.env.INIT_CWD=process.cwd(),process.once("exit",(t=>{O(0,"Service Stopped"),0===t&&process.env.WEBOX_EXIT_CODE&&process.exit(1)}));let h=r.default,E=f,{logger:b,parseJSON:R}=v;h.get(E.WEBOX_CHECK_API+"&version=3.3.10",(t=>{if(200!=t.statusCode)return;let e="";t.on("data",(t=>{e+=t.toString()})),t.on("end",(()=>{let t=R(e);t&&t.message&&b(t.message)}))})).on("error",(t=>{b(1,"Checker Error:",t.message)}));let w=n.default,_=l.default,y=f;function S(t,e){return 0===e.indexOf(".")?t+e:_.join(t,e)}var W={route:"*",handle:function(t,e){let a=new URL(t.url,`http://${t.headers.host}`),i=_.join(y.WEBOX_ROOT,a.pathname);t.filename="",t.requestURL=a;let o=w.existsSync(i)&&w.lstatSync(i);if(o&&o.isFile())t.filename=i;else for(let e of y.WEBOX_INDEX){let a=S(i,e);if(w.existsSync(a))return void(t.filename=a)}}};let X=l.default,j={"3gp":"video/3gpp",a:"application/octet-stream",ai:"application/postscript",aif:"audio/x-aiff",aiff:"audio/x-aiff",asc:"application/pgp-signature",asf:"video/x-ms-asf",asm:"text/x-asm",asx:"video/x-ms-asf",atom:"application/atom+xml",au:"audio/basic",avi:"video/x-msvideo",bat:"application/x-msdownload",bin:"application/octet-stream",bmp:"image/bmp",bz2:"application/x-bzip2",c:"text/x-c",cab:"application/vnd.ms-cab-compressed",cc:"text/x-c",chm:"application/vnd.ms-htmlhelp",class:"application/octet-stream",com:"application/x-msdownload",conf:"text/plain",cpp:"text/x-c",crt:"application/x-x509-ca-cert",css:"text/css",csv:"text/csv",cxx:"text/x-c",deb:"application/x-debian-package",der:"application/x-x509-ca-cert",diff:"text/x-diff",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dll:"application/x-msdownload",dmg:"application/octet-stream",doc:"application/msword",dot:"application/msword",dtd:"application/xml-dtd",dvi:"application/x-dvi",ear:"application/java-archive",eml:"message/rfc822",eps:"application/postscript",exe:"application/x-msdownload",f:"text/x-fortran",f77:"text/x-fortran",f90:"text/x-fortran",flv:"video/x-flv",for:"text/x-fortran",gem:"application/octet-stream",gemspec:"text/x-script.ruby",gif:"image/gif",gz:"application/x-gzip",h:"text/x-c",hh:"text/x-c",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",ifb:"text/calendar",iso:"application/octet-stream",jar:"application/java-archive",java:"text/x-java-source",jnlp:"application/x-java-jnlp-file",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/javascript",json:"application/json",log:"text/plain",m3u:"audio/x-mpegurl",m4v:"video/mp4",man:"text/troff",mathml:"application/mathml+xml",mbox:"application/mbox",mdoc:"text/troff",me:"text/troff",mid:"audio/midi",midi:"audio/midi",mime:"message/rfc822",mml:"application/mathml+xml",mng:"video/x-mng",mov:"video/quicktime",mp3:"audio/mpeg",mp4:"video/mp4",mp4v:"video/mp4",mpeg:"video/mpeg",mpg:"video/mpeg",ms:"text/troff",msi:"application/x-msdownload",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",ogg:"application/ogg",p:"text/x-pascal",pas:"text/x-pascal",pbm:"image/x-portable-bitmap",pdf:"application/pdf",pem:"application/x-x509-ca-cert",pgm:"image/x-portable-graymap",pgp:"application/pgp-encrypted",pkg:"application/octet-stream",pl:"text/x-script.perl",pm:"text/x-script.perl-module",png:"image/png",pnm:"image/x-portable-anymap",ppm:"image/x-portable-pixmap",pps:"application/vnd.ms-powerpoint",ppt:"application/vnd.ms-powerpoint",ps:"application/postscript",psd:"image/vnd.adobe.photoshop",py:"text/x-script.python",qt:"video/quicktime",ra:"audio/x-pn-realaudio",rake:"text/x-script.ruby",ram:"audio/x-pn-realaudio",rar:"application/x-rar-compressed",rb:"text/x-script.ruby",rdf:"application/rdf+xml",roff:"text/troff",rpm:"application/x-redhat-package-manager",rss:"application/rss+xml",rtf:"application/rtf",ru:"text/x-script.ruby",s:"text/x-asm",sgm:"text/sgml",sgml:"text/sgml",sh:"application/x-sh",sig:"application/pgp-signature",snd:"audio/basic",so:"application/octet-stream",svg:"image/svg+xml",svgz:"image/svg+xml",swf:"application/x-shockwave-flash",t:"text/troff",tar:"application/x-tar",tbz:"application/x-bzip-compressed-tar",tcl:"application/x-tcl",tex:"application/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",text:"text/plain",tif:"image/tiff",tiff:"image/tiff",torrent:"application/x-bittorrent",tr:"text/troff",txt:"text/plain",vcf:"text/x-vcard",vcs:"text/x-vcalendar",vrml:"model/vrml",war:"application/java-archive",wav:"audio/x-wav",wma:"audio/x-ms-wma",wmv:"video/x-ms-wmv",wmx:"video/x-ms-wmx",wrl:"model/vrml",wsdl:"application/wsdl+xml",xbm:"image/x-xbitmap",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xslt:"application/xslt+xml",yaml:"text/yaml",yml:"text/yaml",zip:"application/zip",mf:"text/cache-manifest"};let B=n.default,T=function(t){let e=X.extname(t);return e=e?e.slice(1):"unknown",j[e]||"application/octet-stream"},{httpMessage:q,logger:D}=v;var H={route:"*",handle:function(t,e){let{filename:a,requestURL:i}=t;return""===a?(q(e,i.pathname,404),!0):(e.writeHead(200,{"Content-Type":T(a)}),D(1,"Send Static File:",a),B.createReadStream(a).on("error",(t=>{q(e,i.pathname,503)})).on("data",(t=>{e.write(t)})).on("end",(()=>{e.end()})),!0)}};let{exec:M}=s.default,{httpMessage:N}=v;var P={route:function(t,e){return e&&/\.cgi(\.js)?$/.test(e)},handle:function(t,e){let{filename:a,requestURL:i}=t,o="",p=i.search.replace(/^\?/,"").replace(/&/g," "),n=M(`${process.argv0} ${a} ${p}`,{windowsHide:!0,timeout:6e4});return n.stdout.on("data",(t=>{o+=t})),n.stderr.on("data",(t=>{o+=t})),n.on("exit",(t=>{N(e,o,t)})),!0}};let{httpMessage:C}=v;let F=W,I=H,L=[P,{route:function(t,e){return e&&/\.cjs(\.js)?$/.test(e)},handle:function(t,e){let{filename:a,requestURL:i,postData:o}=t;return require(a)({requestURL:i,postData:o},((t,a)=>{C(e,t,a)})),!0}}];var k=function(t){L.splice(-2,0,t)},$=function(t,e){F.handle(t,e);let a=t.filename,i=t.requestURL.pathname;for(let{route:o,handle:p}of L)if((o instanceof RegExp&&o.test(i)||o instanceof Function&&o(i,a)||"string"==typeof o&&("*"===o||o===i))&&p(t,e))return!0;I.handle(t,e)};let z=l.default,U=c.default,J=f,{logger:A}=v,K=$,V=U.createServer(((t,e)=>{switch(A(1,t.method,"-",t.url),t.method){case"POST":let a="";t.addListener("data",(t=>{a+=t})),t.addListener("end",(()=>{try{t.postData=JSON.parse(a)}catch(t){A(0,"POST Error: Only JSON data is supported")}K(t,e)}));break;default:K(t,e)}}));V.on("error",(t=>{"EADDRINUSE"===t.code&&(A(0,"IP-Port in use:",J.WEBOX_HOST,J.WEBOX_PORT),A(0,"Failover to:",J.WEBOX_HOST,++J.WEBOX_PORT,"\n"),V.listen(J.WEBOX_PORT,J.WEBOX_HOST,1024))})),V.on("listening",(()=>{let t="0.0.0.0"===J.WEBOX_HOST?"127.0.0.1":J.WEBOX_HOST,e=J.WEBOX_PORT-80==0?"":":"+J.WEBOX_PORT;A(0,"Server started:","http://"+t+e),A(0,"Root Directory:",J.WEBOX_ROOT,"\n")}));var Y={init:function(t){t&&Object.assign(J,t),J.WEBOX_ROOT=z.resolve(J.WEBOX_ROOT),V.listen(J.WEBOX_PORT,J.WEBOX_HOST,1024)},use:k};module.exports=Y;
//# sourceMappingURL=main.js.map
