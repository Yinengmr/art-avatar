{"version":3,"file":"main.js","sources":["../src/helper/config.js","../src/helper/utils.js","../src/env.js","../src/helper/check.js","../src/middleware/prepare.js","../src/helper/mime.js","../src/middleware/static.js","../src/middleware/use.cgi.js","../src/middleware/use.cjs.js","../src/core/handle.js","../src/core/server.js","../src/main.js"],"sourcesContent":["let fs = require('fs');\n\n// 加载用户配置\n\nlet config = {};\n\nlet CF = process.env.WEBOX_CONF_FILE;\nif (CF && fs.existsSync(CF)) {\n    config = require(CF);\n}\n\n// 合并配置参数\n\nmodule.exports = Object.assign({\n\n    // production or development\n    WEBOX_MODE: process.env.NODE_ENV || 'development',\n\n    WEBOX_HOST: '127.0.0.1',\n\n    WEBOX_PORT: 80,\n\n    WEBOX_ROOT: 'webroot',\n\n    WEBOX_INDEX: [\n        'index.html',\n        'index.htm'\n    ],\n\n    WEBOX_ERROR: {\n        200: '%s',\n        400: 'Bad Request: %s',\n        403: 'Forbidden : %s',\n        404: 'NO Found: %s',\n        500: 'Internal Server Error: %s',\n        503: 'Service Unavilable: %s'\n    },\n\n    WEBOX_CHECK_API: 'https://api.vmlu.com/webox/?platform=node'\n\n}, config);\n","let config = require('./config');\n\n/**\n * 控制台日志\n * @param {number} level 日志级别\n * @param  {...any} msg 日志内容\n */\n\nfunction logger(level, ...msg) {\n\n    if (config.WEBOX_MODE !== 'development' && level > 0) {\n        return;\n    }\n\n    let time = '[' + dateFormat('yyyy-MM-dd hh:mm:ss') + ']';\n    console.log(time, 'Webox -', ...msg);\n\n}\n\n/**\n * 时间格式化\n * @param {string} fmt 格式化选项\n * @param {Date} date 日期对象，默认为当前时间\n * @returns 格式化后的字符串\n */\n\nfunction dateFormat(fmt, date) {\n\n    let d = date || new Date();\n    let o = {\n        'M+': d.getMonth() + 1, //月\n        'd+': d.getDate(), //日\n        'h+': d.getHours(), //时\n        'm+': d.getMinutes(), //分\n        's+': d.getSeconds(), //秒\n        'q+': Math.floor((d.getMonth() + 3) / 3), //季度\n        'S': d.getMilliseconds() //毫秒\n    };\n\n    if (/(y+)/.test(fmt)) { //年\n        fmt = fmt.replace(RegExp.$1, (d.getFullYear() + '').substr(4 - RegExp.$1.length));\n    }\n\n    for (let k in o) {\n        if (new RegExp('(' + k + ')').test(fmt)) {\n            fmt = fmt.replace(RegExp.$1, (RegExp.$1.length === 1) ? (o[k]) : (('00' + o[k]).substr(('' + o[k]).length)));\n        }\n    }\n\n    return fmt;\n\n}\n\n/**\n * 尝试解析JSON\n * @param {string} str JSON字符串\n * @returns 成功返回结果，失败返回`undefined`\n */\n\nfunction parseJSON(str) {\n\n    if (typeof str === 'string') {\n        try {\n            return JSON.parse(str);\n        } catch (e) {\n        }\n    }\n\n}\n\n/**\n * 输出HTTP消息\n * @param {http.ServerResponse} response 响应对象\n * @param {string | object} output 输出内容\n * @param {number} code 状态码\n * @param {string} mime 内容类型\n */\n\nfunction httpMessage(response, output, code, mime) {\n\n    code = code || 200;\n    mime = mime || 'text/plain';\n\n    if (typeof output === 'object') {\n        output = JSON.stringify(output);\n        mime = 'application/json';\n    }\n\n    if (mime == 'text/plain' && config.WEBOX_ERROR[code]) {\n        output = config.WEBOX_ERROR[code].replace('%s', output);\n    }\n\n    response.writeHead(code, {\n        'Content-Length': output.length,\n        'Content-Type': mime\n    });\n\n    response.write(output);\n    response.end();\n\n}\n\n/**\n * 仅用于兼容老版调试工具\n */\n\nif (console.light === undefined) {\n    console.light = Function;\n}\n\nmodule.exports = {\n    logger: logger,\n    parseJSON: parseJSON,\n    dateFormat: dateFormat,\n    httpMessage: httpMessage\n};\n","/**\n * Webox - HTTP Server\n * @author rehiy <wang@rehiy.com>\n * @Website http://www.rehiy.com/webox\n */\n\nlet { logger } = require('./helper/utils');\n\n/////////////////////////////////////////////////////////////\n\n// set title\nprocess.title = 'Webox - HTTP Server';\n\n// set env var for ORIGINAL cwd\nprocess.env.INIT_CWD = process.cwd();\n\n// normal exit with 0 or 1\nprocess.once('exit', code => {\n    logger(0, 'Service Stopped');\n    if (code === 0 && process.env.WEBOX_EXIT_CODE) {\n        process.exit(1);\n    }\n});\n","let https = require('https');\n\nlet config = require('./config');\n\nlet { logger, parseJSON } = require('./utils');\n\nlet req = https.get(config.WEBOX_CHECK_API + '&version=dev', res => {\n\n    if (res.statusCode != 200) {\n        return;\n    }\n\n    let raw = '';\n\n    res.on('data', d => {\n        raw += d.toString();\n    });\n\n    res.on('end', () => {\n        let data = parseJSON(raw);\n        if (data && data.message) {\n            logger(data.message);\n        }\n    });\n\n});\n\nreq.on('error', e => {\n\n    logger(1, 'Checker Error:', e.message);\n\n});\n","let fs = require('fs');\nlet path = require('path');\n\nlet config = require('../helper/config');\n\n/////////////////////////////////////////////////////////////\n\n/**\n * 补全文件路径\n * @param {string} file 路径\n * @param {string} suff 后缀\n * @returns \n */\nfunction fixpath(file, suff) {\n    if (suff.indexOf('.') === 0) {\n        return file + suff;\n    }\n    return path.join(file, suff);\n}\n\n/**\n * 解析HTTP请求\n * @param {http.IncomingMessage} request HTTP请求\n * @param {http.ServerResponse} response HTTP响应\n */\nfunction handle(request, response) {\n\n    let requestURL = new URL(request.url, `http://${request.headers.host}`);\n\n    let filename = path.join(config.WEBOX_ROOT, requestURL.pathname);\n\n    //添加基础属性\n    request.filename = '';\n    request.requestURL = requestURL;\n\n    //文件存在直接返回\n    let filestat = fs.existsSync(filename) && fs.lstatSync(filename);\n    if (filestat && filestat.isFile()) {\n        request.filename = filename;\n        return;\n    }\n\n    //尝试返回默认首页\n    for (let index of config.WEBOX_INDEX) {\n        let file = fixpath(filename, index);\n        if (fs.existsSync(file)) {\n            request.filename = file;\n            return;\n        }\n    }\n\n}\n\n/////////////////////////////////////////////////////////////\n\nmodule.exports = {\n    route: '*',\n    handle: handle\n};\n","let path = require('path');\n\nlet mime = {\n    '3gp': 'video/3gpp',\n    'a': 'application/octet-stream',\n    'ai': 'application/postscript',\n    'aif': 'audio/x-aiff',\n    'aiff': 'audio/x-aiff',\n    'asc': 'application/pgp-signature',\n    'asf': 'video/x-ms-asf',\n    'asm': 'text/x-asm',\n    'asx': 'video/x-ms-asf',\n    'atom': 'application/atom+xml',\n    'au': 'audio/basic',\n    'avi': 'video/x-msvideo',\n    'bat': 'application/x-msdownload',\n    'bin': 'application/octet-stream',\n    'bmp': 'image/bmp',\n    'bz2': 'application/x-bzip2',\n    'c': 'text/x-c',\n    'cab': 'application/vnd.ms-cab-compressed',\n    'cc': 'text/x-c',\n    'chm': 'application/vnd.ms-htmlhelp',\n    'class': 'application/octet-stream',\n    'com': 'application/x-msdownload',\n    'conf': 'text/plain',\n    'cpp': 'text/x-c',\n    'crt': 'application/x-x509-ca-cert',\n    'css': 'text/css',\n    'csv': 'text/csv',\n    'cxx': 'text/x-c',\n    'deb': 'application/x-debian-package',\n    'der': 'application/x-x509-ca-cert',\n    'diff': 'text/x-diff',\n    'djv': 'image/vnd.djvu',\n    'djvu': 'image/vnd.djvu',\n    'dll': 'application/x-msdownload',\n    'dmg': 'application/octet-stream',\n    'doc': 'application/msword',\n    'dot': 'application/msword',\n    'dtd': 'application/xml-dtd',\n    'dvi': 'application/x-dvi',\n    'ear': 'application/java-archive',\n    'eml': 'message/rfc822',\n    'eps': 'application/postscript',\n    'exe': 'application/x-msdownload',\n    'f': 'text/x-fortran',\n    'f77': 'text/x-fortran',\n    'f90': 'text/x-fortran',\n    'flv': 'video/x-flv',\n    'for': 'text/x-fortran',\n    'gem': 'application/octet-stream',\n    'gemspec': 'text/x-script.ruby',\n    'gif': 'image/gif',\n    'gz': 'application/x-gzip',\n    'h': 'text/x-c',\n    'hh': 'text/x-c',\n    'htm': 'text/html',\n    'html': 'text/html',\n    'ico': 'image/vnd.microsoft.icon',\n    'ics': 'text/calendar',\n    'ifb': 'text/calendar',\n    'iso': 'application/octet-stream',\n    'jar': 'application/java-archive',\n    'java': 'text/x-java-source',\n    'jnlp': 'application/x-java-jnlp-file',\n    'jpeg': 'image/jpeg',\n    'jpg': 'image/jpeg',\n    'js': 'application/javascript',\n    'json': 'application/json',\n    'log': 'text/plain',\n    'm3u': 'audio/x-mpegurl',\n    'm4v': 'video/mp4',\n    'man': 'text/troff',\n    'mathml': 'application/mathml+xml',\n    'mbox': 'application/mbox',\n    'mdoc': 'text/troff',\n    'me': 'text/troff',\n    'mid': 'audio/midi',\n    'midi': 'audio/midi',\n    'mime': 'message/rfc822',\n    'mml': 'application/mathml+xml',\n    'mng': 'video/x-mng',\n    'mov': 'video/quicktime',\n    'mp3': 'audio/mpeg',\n    'mp4': 'video/mp4',\n    'mp4v': 'video/mp4',\n    'mpeg': 'video/mpeg',\n    'mpg': 'video/mpeg',\n    'ms': 'text/troff',\n    'msi': 'application/x-msdownload',\n    'odp': 'application/vnd.oasis.opendocument.presentation',\n    'ods': 'application/vnd.oasis.opendocument.spreadsheet',\n    'odt': 'application/vnd.oasis.opendocument.text',\n    'ogg': 'application/ogg',\n    'p': 'text/x-pascal',\n    'pas': 'text/x-pascal',\n    'pbm': 'image/x-portable-bitmap',\n    'pdf': 'application/pdf',\n    'pem': 'application/x-x509-ca-cert',\n    'pgm': 'image/x-portable-graymap',\n    'pgp': 'application/pgp-encrypted',\n    'pkg': 'application/octet-stream',\n    'pl': 'text/x-script.perl',\n    'pm': 'text/x-script.perl-module',\n    'png': 'image/png',\n    'pnm': 'image/x-portable-anymap',\n    'ppm': 'image/x-portable-pixmap',\n    'pps': 'application/vnd.ms-powerpoint',\n    'ppt': 'application/vnd.ms-powerpoint',\n    'ps': 'application/postscript',\n    'psd': 'image/vnd.adobe.photoshop',\n    'py': 'text/x-script.python',\n    'qt': 'video/quicktime',\n    'ra': 'audio/x-pn-realaudio',\n    'rake': 'text/x-script.ruby',\n    'ram': 'audio/x-pn-realaudio',\n    'rar': 'application/x-rar-compressed',\n    'rb': 'text/x-script.ruby',\n    'rdf': 'application/rdf+xml',\n    'roff': 'text/troff',\n    'rpm': 'application/x-redhat-package-manager',\n    'rss': 'application/rss+xml',\n    'rtf': 'application/rtf',\n    'ru': 'text/x-script.ruby',\n    's': 'text/x-asm',\n    'sgm': 'text/sgml',\n    'sgml': 'text/sgml',\n    'sh': 'application/x-sh',\n    'sig': 'application/pgp-signature',\n    'snd': 'audio/basic',\n    'so': 'application/octet-stream',\n    'svg': 'image/svg+xml',\n    'svgz': 'image/svg+xml',\n    'swf': 'application/x-shockwave-flash',\n    't': 'text/troff',\n    'tar': 'application/x-tar',\n    'tbz': 'application/x-bzip-compressed-tar',\n    'tcl': 'application/x-tcl',\n    'tex': 'application/x-tex',\n    'texi': 'application/x-texinfo',\n    'texinfo': 'application/x-texinfo',\n    'text': 'text/plain',\n    'tif': 'image/tiff',\n    'tiff': 'image/tiff',\n    'torrent': 'application/x-bittorrent',\n    'tr': 'text/troff',\n    'txt': 'text/plain',\n    'vcf': 'text/x-vcard',\n    'vcs': 'text/x-vcalendar',\n    'vrml': 'model/vrml',\n    'war': 'application/java-archive',\n    'wav': 'audio/x-wav',\n    'wma': 'audio/x-ms-wma',\n    'wmv': 'video/x-ms-wmv',\n    'wmx': 'video/x-ms-wmx',\n    'wrl': 'model/vrml',\n    'wsdl': 'application/wsdl+xml',\n    'xbm': 'image/x-xbitmap',\n    'xhtml': 'application/xhtml+xml',\n    'xls': 'application/vnd.ms-excel',\n    'xml': 'application/xml',\n    'xpm': 'image/x-xpixmap',\n    'xsl': 'application/xml',\n    'xslt': 'application/xslt+xml',\n    'yaml': 'text/yaml',\n    'yml': 'text/yaml',\n    'zip': 'application/zip',\n    'mf': 'text/cache-manifest'\n};\n\nmodule.exports = function (file) {\n    let ext = path.extname(file);\n    ext = ext ? ext.slice(1) : 'unknown';\n    return mime[ext] || 'application/octet-stream';\n}\n","let fs = require('fs');\n\nlet getMimeType = require('../helper/mime');\n\nlet { httpMessage, logger } = require('../helper/utils');\n\n/////////////////////////////////////////////////////////////\n\n/**\n * 处理静态文件\n * @param {http.IncomingMessage} request HTTP请求\n * @param {http.ServerResponse} response HTTP响应\n */\nfunction handle(request, response) {\n\n    let { filename, requestURL } = request;\n\n    //找不到文件\n    if (filename === '') {\n        httpMessage(response, requestURL.pathname, 404);\n        return true;\n    }\n\n    //输出文件头\n    response.writeHead(200, {\n        'Content-Type': getMimeType(filename)\n    });\n\n    logger(1, 'Send Static File:', filename);\n\n    //流式发送文件\n    fs.createReadStream(filename)\n        .on('error', err => {\n            httpMessage(response, requestURL.pathname, 503);\n        })\n        .on('data', chunk => {\n            response.write(chunk);\n        })\n        .on('end', () => {\n            response.end();\n        });\n\n    return true;\n\n};\n\n/////////////////////////////////////////////////////////////\n\nmodule.exports = {\n    route: '*',\n    handle: handle\n};\n","let { exec } = require('child_process');\n\nlet { httpMessage } = require('../helper/utils');\n\n/////////////////////////////////////////////////////////////\n\n/**\n * 路由检查\n * @param {string} p pathname\n * @param {string} f filename\n * @returns 是否调用处理函数\n */\nfunction route(p, f) {\n    return f && /\\.cgi(\\.js)?$/.test(f);\n}\n\n/**\n * 处理HTTP请求\n * @param {http.IncomingMessage} request HTTP请求\n * @param {http.ServerResponse} response HTTP响应\n */\nfunction handle(request, response) {\n\n    let { filename, requestURL } = request;\n\n    let text = '';\n\n    let args = requestURL.search.replace(/^\\?/, '').replace(/&/g, ' ');\n\n    let child = exec(`${process.argv0} ${filename} ${args}`, {\n        windowsHide: true,\n        timeout: 60000\n    });\n\n    child.stdout.on('data', data => {\n        text += data;\n    });\n    child.stderr.on('data', data => {\n        text += data;\n    });\n\n    child.on('exit', code => {\n        code === 0 ? 200 : 503;\n        httpMessage(response, text, code);\n    });\n\n    return true;\n\n}\n\n/////////////////////////////////////////////////////////////\n\nmodule.exports = {\n    route: route,\n    handle: handle\n};\n\n","let { httpMessage } = require('../helper/utils');\n\n/////////////////////////////////////////////////////////////\n\n/**\n * 路由检查\n * @param {string} p pathname\n * @param {string} f filename\n * @returns 是否调用处理函数\n */\nfunction route(p, f) {\n    return f && /\\.cjs(\\.js)?$/.test(f);\n}\n\n/**\n * 处理HTTP请求\n * @param {http.IncomingMessage} request HTTP请求\n * @param {http.ServerResponse} response HTTP响应\n */\nfunction handle(request, response) {\n\n    let { filename, requestURL, postData } = request;\n\n    let child = require(filename);\n\n    child({ requestURL, postData }, (text, code) => {\n        httpMessage(response, text, code);\n    });\n\n    return true;\n\n}\n\n/////////////////////////////////////////////////////////////\n\nmodule.exports = {\n    route: route,\n    handle: handle\n};\n","let M_prepare = require('../middleware/prepare');\nlet M_static = require('../middleware/static');\n\nlet M_cgi = require('../middleware/use.cgi');\nlet M_cjs = require('../middleware/use.cjs');\n\n/////////////////////////////////////////////////////////////\n\nlet handlers = [\n    M_cgi, M_cjs\n];\n\nfunction push(handler) {\n    handlers.splice(-2, 0, handler);\n}\n\nfunction call(request, response) {\n\n    M_prepare.handle(request, response);\n\n    let filename = request.filename;\n    let pathname = request.requestURL.pathname;\n\n    for (let { route, handle } of handlers) {\n\n        if (\n            (route instanceof RegExp && route.test(pathname)) ||\n            (route instanceof Function && route(pathname, filename)) ||\n            (typeof route === 'string' && (route === '*' || route === pathname))\n        ) {\n            if (handle(request, response)) {\n                return true;\n            }\n        }\n\n    }\n\n    M_static.handle(request, response);\n\n}\n\n/////////////////////////////////////////////////////////////\n\nmodule.exports = {\n    push: push,\n    call: call\n};\n","let path = require('path');\nlet http = require('http');\n\nlet config = require('../helper/config');\n\nlet { logger } = require('../helper/utils');\n\nlet handleCaller = require('./handle').call;\n\n/////////////////////////////////////////////////////////////\n// create server\n\nlet httpServer = http.createServer((request, response) => {\n\n    logger(1, request.method, '-', request.url);\n\n    switch (request.method) {\n        case 'POST':\n            let body = '';\n            request.addListener('data', data => {\n                body += data\n            });\n            request.addListener('end', () => {\n                try {\n                    request.postData = JSON.parse(body);\n                } catch (e) {\n                    logger(0, 'POST Error: Only JSON data is supported');\n                }\n                handleCaller(request, response);\n            });\n            break;\n        default:\n            handleCaller(request, response);\n            break;\n    }\n\n});\n\nhttpServer.on('error', err => {\n\n    if (err.code === 'EADDRINUSE') {\n        logger(0, 'IP-Port in use:', config.WEBOX_HOST, config.WEBOX_PORT);\n        logger(0, 'Failover to:', config.WEBOX_HOST, ++config.WEBOX_PORT, '\\n');\n        httpServer.listen(config.WEBOX_PORT, config.WEBOX_HOST, 1024);\n    }\n\n});\n\nhttpServer.on('listening', () => {\n\n    let host = config.WEBOX_HOST === '0.0.0.0' ? '127.0.0.1' : config.WEBOX_HOST;\n    let port = config.WEBOX_PORT - 80 === 0 ? '' : ':' + config.WEBOX_PORT;\n\n    logger(0, 'Server started:', 'http://' + host + port);\n    logger(0, 'Root Directory:', config.WEBOX_ROOT, '\\n');\n\n});\n\n/////////////////////////////////////////////////////////////\n// start server\n\nmodule.exports = function (options) {\n\n    options && Object.assign(config, options);\n\n    config.WEBOX_ROOT = path.resolve(config.WEBOX_ROOT);\n\n    httpServer.listen(config.WEBOX_PORT, config.WEBOX_HOST, 1024);\n\n};\n","/**\n * Webox - HTTP Server\n * @author rehiy <wang@rehiy.com>\n * @Website http://www.rehiy.com/webox\n */\n\n'use strict';\n\n// load env\nrequire('./env');\n\n// security check\nrequire('./helper/check');\n\n/////////////////////////////////////////////////////////////\n\nlet use = require('./core/handle').push;\n\nlet server = require('./core/server');\n\nmodule.exports = {\n    init: server,\n    use: use\n};\n"],"names":["fs","require$$0","config","CF","process","env","WEBOX_CONF_FILE","existsSync","require","config_1","Object","assign","WEBOX_MODE","NODE_ENV","WEBOX_HOST","WEBOX_PORT","WEBOX_ROOT","WEBOX_INDEX","WEBOX_ERROR","WEBOX_CHECK_API","dateFormat","fmt","date","d","Date","o","getMonth","getDate","getHours","getMinutes","getSeconds","Math","floor","S","getMilliseconds","test","replace","RegExp","$1","getFullYear","substr","length","k","undefined","console","light","Function","utils","logger","level","msg","time","log","parseJSON","str","JSON","parse","e","httpMessage","response","output","code","mime","stringify","writeHead","write","end","title","INIT_CWD","cwd","once","WEBOX_EXIT_CODE","exit","https","require$$1","require$$2","get","res","statusCode","raw","on","toString","data","message","path","fixpath","file","suff","indexOf","join","prepare","route","handle","request","requestURL","URL","url","headers","host","filename","pathname","filestat","lstatSync","isFile","index","a","ai","aif","aiff","asc","asf","asm","asx","atom","au","avi","bat","bin","bmp","bz2","c","cab","cc","chm","class","com","conf","cpp","crt","css","csv","cxx","deb","der","diff","djv","djvu","dll","dmg","doc","dot","dtd","dvi","ear","eml","eps","exe","f","f77","f90","flv","for","gem","gemspec","gif","gz","h","hh","htm","html","ico","ics","ifb","iso","jar","java","jnlp","jpeg","jpg","js","json","m3u","m4v","man","mathml","mbox","mdoc","me","mid","midi","mml","mng","mov","mp3","mp4","mp4v","mpeg","mpg","ms","msi","odp","ods","odt","ogg","p","pas","pbm","pdf","pem","pgm","pgp","pkg","pl","pm","png","pnm","ppm","pps","ppt","ps","psd","py","qt","ra","rake","ram","rar","rb","rdf","roff","rpm","rss","rtf","ru","s","sgm","sgml","sh","sig","snd","so","svg","svgz","swf","t","tar","tbz","tcl","tex","texi","texinfo","text","tif","tiff","torrent","tr","txt","vcf","vcs","vrml","war","wav","wma","wmv","wmx","wrl","wsdl","xbm","xhtml","xls","xml","xpm","xsl","xslt","yaml","yml","zip","mf","getMimeType","ext","extname","slice","_static","createReadStream","err","chunk","exec","use_cgi","args","search","child","argv0","windowsHide","timeout","stdout","stderr","M_prepare","M_static","handlers","postData","handle_1","handler","splice","http","require$$3","handleCaller","require$$4","httpServer","createServer","method","body","addListener","listen","port","main","init","options","resolve","use"],"mappings":"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"}